{
  "comments": [
    {
      "key": {
        "uuid": "f0e08410_23be1993",
        "filename": "libs/binder/ndk/include_ndk/android/binder_auto_utils.h",
        "patchSetId": 2
      },
      "lineNbr": 87,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2018-10-09T17:38:24Z",
      "side": 1,
      "message": "this is a pretty small window to hit, and I think the compiler is allowed to optimize this away. Take a look at the object code?",
      "range": {
        "startLine": 87,
        "startChar": 8,
        "endLine": 87,
        "endChar": 29
      },
      "revId": "e7a8f3d475e007ff91dae1491f68d913a9d1a2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e6960b06_feec6500",
        "filename": "libs/binder/ndk/include_ndk/android/binder_auto_utils.h",
        "patchSetId": 2
      },
      "lineNbr": 87,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2018-10-09T18:18:25Z",
      "side": 1,
      "message": "https://android-review.googlesource.com/c/platform/frameworks/native/+/782580/1/libs/binder/ndk/include_ndk/android/binder_auto_utils.h#89\n\nSee the thread pointed to by this thread. I agree, but it is in order to match sp.",
      "parentUuid": "f0e08410_23be1993",
      "range": {
        "startLine": 87,
        "startChar": 8,
        "endLine": 87,
        "endChar": 29
      },
      "revId": "e7a8f3d475e007ff91dae1491f68d913a9d1a2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1645493f_f1017d24",
        "filename": "libs/binder/ndk/include_ndk/android/binder_auto_utils.h",
        "patchSetId": 2
      },
      "lineNbr": 87,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2018-10-10T17:57:25Z",
      "side": 1,
      "message": "The windows is often not that small, since presumably decStrong recursively decrements and invokes destructors. And at a minimum, the atomic acquire/release decrement is typically at least a few dozen cycles. In experiments with Skia, this seemed to get at least as many race manages as actual crashes, when there was a race. (The double deallocate/crash window is of similar size.)\n\nThe sp\u003c\u003e code does volatile loads of the equivalent of mBinder. That prevents coalescing of the two loads. I\u0027m not sure that\u0027s absolutely necessary here, since the compiler often won\u0027t have enough context to determine that the decStrong call doesn\u0027t touch mBinder, but I would do it here as well, in spite of the ugliness. (The Linux kernel uses a READ_ONCE macro to alleviate such ugliness; we could conceivably do something similar.)",
      "parentUuid": "e6960b06_feec6500",
      "range": {
        "startLine": 87,
        "startChar": 8,
        "endLine": 87,
        "endChar": 29
      },
      "revId": "e7a8f3d475e007ff91dae1491f68d913a9d1a2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f85d8645_c3e77eee",
        "filename": "libs/binder/ndk/include_ndk/android/binder_auto_utils.h",
        "patchSetId": 2
      },
      "lineNbr": 87,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2018-10-10T19:28:15Z",
      "side": 1,
      "message": "Done (volatile loads)",
      "parentUuid": "1645493f_f1017d24",
      "range": {
        "startLine": 87,
        "startChar": 8,
        "endLine": 87,
        "endChar": 29
      },
      "revId": "e7a8f3d475e007ff91dae1491f68d913a9d1a2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6d5064f0_66802a20",
        "filename": "libs/binder/ndk/include_ndk/android/binder_interface_utils.h",
        "patchSetId": 2
      },
      "lineNbr": 57,
      "author": {
        "id": 1013030
      },
      "writtenOn": "2018-10-09T17:38:24Z",
      "side": 1,
      "message": "this one I think is very useful though.",
      "range": {
        "startLine": 52,
        "startChar": 4,
        "endLine": 57,
        "endChar": 5
      },
      "revId": "e7a8f3d475e007ff91dae1491f68d913a9d1a2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "26ee56da_d3616846",
        "filename": "libs/binder/ndk/include_ndk/android/binder_interface_utils.h",
        "patchSetId": 2
      },
      "lineNbr": 57,
      "author": {
        "id": 1120458
      },
      "writtenOn": "2018-10-09T18:18:25Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6d5064f0_66802a20",
      "range": {
        "startLine": 52,
        "startChar": 4,
        "endLine": 57,
        "endChar": 5
      },
      "revId": "e7a8f3d475e007ff91dae1491f68d913a9d1a2b0",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}