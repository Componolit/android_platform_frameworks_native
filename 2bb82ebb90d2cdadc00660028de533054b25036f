{
  "comments": [
    {
      "key": {
        "uuid": "4faf4d3e_e6f0c80b",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 144,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2018-12-03T12:47:33Z",
      "side": 1,
      "message": "do you know why we\u0027re using O_NONBLOCK here ?",
      "range": {
        "startLine": 144,
        "startChar": 58,
        "endLine": 144,
        "endChar": 68
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f88ebafc_9b94690d",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 144,
      "author": {
        "id": 1336554
      },
      "writtenOn": "2018-12-04T10:28:49Z",
      "side": 1,
      "message": "It\u0027s used nearly everywhere in this code and there are comments to the effect of \"to avoid issues where opening the file itself can get stuck.\"",
      "parentUuid": "4faf4d3e_e6f0c80b",
      "range": {
        "startLine": 144,
        "startChar": 58,
        "endLine": 144,
        "endChar": 68
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1648bc4d_b4feea09",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 147,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2018-12-03T12:47:33Z",
      "side": 1,
      "message": "are in_fd / out_fd both regular files ? if one of the fds is a pipe, you can use splice instead.",
      "range": {
        "startLine": 147,
        "startChar": 13,
        "endLine": 147,
        "endChar": 36
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c18b1dd7_8b9388d4",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 147,
      "author": {
        "id": 1336554
      },
      "writtenOn": "2018-12-04T10:28:49Z",
      "side": 1,
      "message": "out_fd can be a pipe in one of the cases, but not all usecases.\n\nAre you worried about on copying taking time?",
      "parentUuid": "1648bc4d_b4feea09",
      "range": {
        "startLine": 147,
        "startChar": 13,
        "endLine": 147,
        "endChar": 36
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "37938e58_5f8df525",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 162,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2018-12-03T12:47:33Z",
      "side": 1,
      "message": "Does this really copy to an OutputDirectory ? Seems obsolete.",
      "range": {
        "startLine": 162,
        "startChar": 22,
        "endLine": 162,
        "endChar": 38
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "18474889_6c91cf28",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 162,
      "author": {
        "id": 1336554
      },
      "writtenOn": "2018-12-04T10:28:49Z",
      "side": 1,
      "message": "it does, but the caller handles the path creation, so agree we should rename.",
      "parentUuid": "37938e58_5f8df525",
      "range": {
        "startLine": 162,
        "startChar": 22,
        "endLine": 162,
        "endChar": 38
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "eacc20bc_5da628aa",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 168,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2018-12-03T12:47:33Z",
      "side": 1,
      "message": "nit: i think it would be more consistent to name this out_fd (to match in_fd) and rename the command line argument.",
      "range": {
        "startLine": 168,
        "startChar": 29,
        "endLine": 168,
        "endChar": 43
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f1ff4008_73f5f078",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 168,
      "author": {
        "id": 1336554
      },
      "writtenOn": "2018-12-04T10:28:49Z",
      "side": 1,
      "message": "there is already an out_fd",
      "parentUuid": "eacc20bc_5da628aa",
      "range": {
        "startLine": 168,
        "startChar": 29,
        "endLine": 168,
        "endChar": 43
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "21abeaa1_4bd57134",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 170,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2018-12-03T12:47:33Z",
      "side": 1,
      "message": "comment is incorrect",
      "range": {
        "startLine": 170,
        "startChar": 43,
        "endLine": 170,
        "endChar": 56
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7abb1159_db6fba7e",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 170,
      "author": {
        "id": 1336554
      },
      "writtenOn": "2018-12-04T10:28:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "21abeaa1_4bd57134",
      "range": {
        "startLine": 170,
        "startChar": 43,
        "endLine": 170,
        "endChar": 56
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "413d2843_cd19e622",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 178,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2018-12-03T12:47:33Z",
      "side": 1,
      "message": "i was confused by this assignment. it would be less confusing (and symmetric) to consistently use output_file_fd from this point on.",
      "range": {
        "startLine": 178,
        "startChar": 3,
        "endLine": 178,
        "endChar": 38
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "428c6e62_4e976b05",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 178,
      "author": {
        "id": 1336554
      },
      "writtenOn": "2018-12-04T10:28:49Z",
      "side": 1,
      "message": "I can\u0027t because output_file_fd may not be assigned if out_fd is valid. And I don\u0027t want to assign output_file_fd.reset(out_fd) at the outset because I don\u0027t want to close the fd supplied by the caller of the API. \n\nI can duplicate out_fd and assign to output_file_fd, if that reads better for you",
      "parentUuid": "413d2843_cd19e622",
      "range": {
        "startLine": 178,
        "startChar": 3,
        "endLine": 178,
        "endChar": 38
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "94b87f9b_3b4f966b",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 2244,
      "author": {
        "id": 1013984
      },
      "writtenOn": "2018-12-04T04:34:36Z",
      "side": 1,
      "message": "typo",
      "range": {
        "startLine": 2244,
        "startChar": 18,
        "endLine": 2244,
        "endChar": 30
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "31dfcf09_0497d036",
        "filename": "cmds/dumpstate/dumpstate.cpp",
        "patchSetId": 2
      },
      "lineNbr": 2244,
      "author": {
        "id": 1336554
      },
      "writtenOn": "2018-12-04T10:28:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "94b87f9b_3b4f966b",
      "range": {
        "startLine": 2244,
        "startChar": 18,
        "endLine": 2244,
        "endChar": 30
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5aec1971_b6b3737e",
        "filename": "cmds/dumpstate/dumpstate.h",
        "patchSetId": 2
      },
      "lineNbr": 169,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2018-12-03T12:47:33Z",
      "side": 1,
      "message": "This should be static const. Same issue with the strings above, but those can be fixed in a separate change.\n\nAlso, I don\u0027t think you can assume this path (especially the user_de/0/ path) -- will this change in a future change ?",
      "range": {
        "startLine": 169,
        "startChar": 0,
        "endLine": 169,
        "endChar": 18
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ce426848_3a224fd5",
        "filename": "cmds/dumpstate/dumpstate.h",
        "patchSetId": 2
      },
      "lineNbr": 169,
      "author": {
        "id": 1013984
      },
      "writtenOn": "2018-12-04T04:34:36Z",
      "side": 1,
      "message": "We can use /bugreports directly, that symlinks is always there since O or so.",
      "parentUuid": "5aec1971_b6b3737e",
      "range": {
        "startLine": 169,
        "startChar": 0,
        "endLine": 169,
        "endChar": 18
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "689765cd_4cc01586",
        "filename": "cmds/dumpstate/dumpstate.h",
        "patchSetId": 2
      },
      "lineNbr": 169,
      "author": {
        "id": 1336554
      },
      "writtenOn": "2018-12-04T10:28:49Z",
      "side": 1,
      "message": "The path is hardcoded already (albeit as an commandline argument in .rc files). Is /bugreports better for you, Narayan?\n\n2 things to note: 1) there are a bunch of O_NOFOLLOWs in code and we just need to be careful none of that is broken. 2) the 2 paths input_file and output_file in CopyFileToOutputFileOrFd are different but point to same file, so need to handle it properly.",
      "parentUuid": "ce426848_3a224fd5",
      "range": {
        "startLine": 169,
        "startChar": 0,
        "endLine": 169,
        "endChar": 18
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "67e0a5b8_ead59878",
        "filename": "cmds/dumpstate/dumpstate.h",
        "patchSetId": 2
      },
      "lineNbr": 406,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2018-12-03T12:47:33Z",
      "side": 1,
      "message": "so, tying this in to the comment above, am I right in understanding that dumpstate uses a directory owned by com.android.shell as its working directory ? That seems pretty non-ideal since it\u0027s a really tight dependency (more than just the path..) which seems wrong.",
      "range": {
        "startLine": 406,
        "startChar": 16,
        "endLine": 406,
        "endChar": 39
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "344f2a3f_743c1957",
        "filename": "cmds/dumpstate/dumpstate.h",
        "patchSetId": 2
      },
      "lineNbr": 406,
      "author": {
        "id": 1013984
      },
      "writtenOn": "2018-12-04T04:34:36Z",
      "side": 1,
      "message": "The main (if only) reason dumpstate uses the Shell\u0027s directory is because it can then share the file with the recipients of BugreportFinished, using Android\u0027s URI grant sharing...",
      "parentUuid": "67e0a5b8_ead59878",
      "range": {
        "startLine": 406,
        "startChar": 16,
        "endLine": 406,
        "endChar": 39
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "27a5bf5c_42dcd05e",
        "filename": "cmds/dumpstate/dumpstate.h",
        "patchSetId": 2
      },
      "lineNbr": 406,
      "author": {
        "id": 1336554
      },
      "writtenOn": "2018-12-04T10:28:49Z",
      "side": 1,
      "message": "Like Felipe said it\u0027s not a new dependency. I was planning to keep the dependency, for the power user usecase, where we don\u0027t want dumpstate to wait for the caller to give all the arguments, so writing to a directory shared with shell made sense. \n\nBut we can also make shell bind and lazily pass in its directory.",
      "parentUuid": "344f2a3f_743c1957",
      "range": {
        "startLine": 406,
        "startChar": 16,
        "endLine": 406,
        "endChar": 39
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a94a2aab_03c22b73",
        "filename": "cmds/dumpstate/dumpstate.h",
        "patchSetId": 2
      },
      "lineNbr": 406,
      "author": {
        "id": 1013984
      },
      "writtenOn": "2018-12-04T17:03:33Z",
      "side": 1,
      "message": "Just to clarify, are you planning to write the bugreport directly to the fd passed by the caller of the new API, instead of writing it to a temporary file on Shell\u0027s directory?\nIf so, I\u0027m not sure if that will work, because we\u0027ll need to show the UI consent before writing to that FD, and ad the same time we don\u0027t want to block the start of the bugreport (or did we decide that the delay is accepted when using the API? I forgot :-(",
      "parentUuid": "27a5bf5c_42dcd05e",
      "range": {
        "startLine": 406,
        "startChar": 16,
        "endLine": 406,
        "endChar": 39
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "65100854_7221fa16",
        "filename": "cmds/dumpstate/utils.cpp",
        "patchSetId": 2
      },
      "lineNbr": 231,
      "author": {
        "id": 1014443
      },
      "writtenOn": "2018-12-03T12:47:33Z",
      "side": 1,
      "message": "just FYI : I was terribly confused by the fact that a member function on Dumpstate was in utils.cpp and not DumpState.cpp. This is pretty unusual C++ style -- is it the norm for this codebase ?",
      "range": {
        "startLine": 231,
        "startChar": 12,
        "endLine": 231,
        "endChar": 30
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "156a4f2f_ecf2cd60",
        "filename": "cmds/dumpstate/utils.cpp",
        "patchSetId": 2
      },
      "lineNbr": 231,
      "author": {
        "id": 1013984
      },
      "writtenOn": "2018-12-04T04:34:36Z",
      "side": 1,
      "message": "I believe utils.cpp is the \"legacy\" code, from the time we started the migration from C to C++; we should move new code to the \"camel case files\" (like DumpstateUtil.cpp and DumpstateInternal.cpp), until we eventually get rid of utils.cpp and dumstate.cpp.",
      "parentUuid": "65100854_7221fa16",
      "range": {
        "startLine": 231,
        "startChar": 12,
        "endLine": 231,
        "endChar": 30
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b4647abe_ba12ac92",
        "filename": "cmds/dumpstate/utils.cpp",
        "patchSetId": 2
      },
      "lineNbr": 231,
      "author": {
        "id": 1336554
      },
      "writtenOn": "2018-12-04T10:28:49Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "156a4f2f_ecf2cd60",
      "range": {
        "startLine": 231,
        "startChar": 12,
        "endLine": 231,
        "endChar": 30
      },
      "revId": "2bb82ebb90d2cdadc00660028de533054b25036f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}